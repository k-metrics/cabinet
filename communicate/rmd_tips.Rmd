---
title: "R Markdown Tips"
output: 
  html_document:  
    number_section: no
---

<!-- Include Common Links -->
```{r example_3, child="../common/links.Rmd"}
```

```{r setup, include=FALSE}
# 共通chunkオプションの指定
knitr::opts_chunk$set(warning = FALSE, echo = TRUE)

# データハンドリングで利用するパッケージの読み込み
require(tidyverse)

# 表示で利用する外部パッケージの読み込み
require(gridExtra)
require(DT)
require(knitr)
require(extrafont)

# モデリングで利用するパッケージの読み込み
require(psych)

# コンフリクトの解消
tidyverse::tidyverse_conflicts()

# 共通ローカル関数の読み込み
source("../common/common.R")
```

# レンダリングしても変わらない
レンダリングしても出力結果が変わらない

## 原因
レンダリングキャッシュが残っているため

## 対応
レンダリングしても出力結果が変わらないような場合にはキャッシュをクリアする必要があります。RStudioであればメニューの［Knit］-［Clear Knitr Cache...］を実行するかコンソールから以下の関数を実行してください。

```{r, eval=FALSE}
unlink("cache path", recursive=TRUE)
```

**`cache path`**にはキャッシュディレクトリをカレントワーキングディレクトリからの相対パスで指定してください。キャッシュディレクトリ名はデフォルトで**`*_cache`と**いうような名前になっています。

なお、カレントワーキングディレクトリは**`getwd`**関数で取得可能です。  
　  

# R Markdown Website
Windows環境で上手くクリーン、ビルドできない。**`_site.yml`**に設定した日本語メニューが化ける。

## 原因
**`yaml`**パッケージや**`rmarkdown`**パッケージがファイルのエンコーディングをOSのエンコーディングと同一であることを前提に処理しているために日本語Winodws環境でのみ起きるバグです。

## 対応
**`yaml`**パッケージを2.1.15以降にアップデートしてください。また、クリーンする場合はRStudioの**`[More]-[Clean All]`**メニューではなくコンソールから以下の関数を実行してください、

```{r, echo=FALSE}
rmarkdown::clean_site(input="clean path", encoding="encoding")
```

**`clean path`**にはクリーン対象となるパスをカレントワーキングディレクトリからの相対パスで指定します。カレントワーキングディレクトリとクリーン対象とするパスが同一の場合は省略可能です。  
**`encoding`**にはビルド対象となるファイルのエンコーディングを指定してます。R Markdownでドキュメントを作成する場合の推奨エンコーディングは**`UTF-8`**ですので、通常は**`UTF-8`**を指定すれば済みますが、もし、Shift JISなどの他のエンコーディングを利用している場合はその旨、指定してください。

Encoding  | Code  | 備考
----------|-------|-----
Shift JIS | CP932 | SJISでも可
UTF-8N    | UTF-8 | BOM^1)^なし

^1)^ BOM(Byte Order Marks)はExcelなどで使われているバイトの並び順を識別できるようにしたバイナリ情報。BOMありBOMなしを区別するためにBOMなしは**`UTF-8N`**と記述することがある

〉 R Markdown関連のドキュメントは**`UTF-8`**で作成することをおすゝめします。  
　  

# child chunk
## 原因
R Markdownのデフォルト設定ではチャンク名の重複を許していないため。

## 対応
チャンクでchildを読み込む際にchild側でも**`setup`**チャンクを使えるようにする設定（[r-wakalangより](https://r-wakalang.slack.com/files/U06PKTQ8K/F6RBNHKJT/-.md)）  
ラベル名がダブっても処理上、許可するオプションを使うので、`setup`チャンク以外でもチャンク名を使っている際は注意する必要があります。  
<!-- 親の方： -->
<!-- ```{r setup, include=FALSE} -->
<!-- knitr::opts_chunk$set(echo = TRUE, -->
<!--                       collapse = TRUE) -->

<!-- # ラベル名かぶっても大丈夫なようにする（ラベル名を変えるならこれは必要なし） -->
<!-- options(knitr.duplicate.label = 'allow') -->

<!-- # この変数があったらevalしない、という規約にする -->
<!-- mouyatta <- 'yeah' -->
<!-- ``` -->

<!-- 子の方： -->
<!-- ```{r setup, include=FALSE, eval=!exists('mouyatta')} -->
<!-- knitr::opts_chunk$set(echo = TRUE, -->
<!--                       comment = " #>") -->
<!-- ``` -->