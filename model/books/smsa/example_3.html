<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>第3章 例題解答例</title>

<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<script src="site_libs/htmlwidgets-0.8/htmlwidgets.js"></script>
<script src="site_libs/datatables-binding-0.2/datatables.js"></script>
<link href="site_libs/dt-core-bootstrap-1.10.12/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-bootstrap-1.10.12/css/dataTables.bootstrap.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-bootstrap-1.10.12/js/jquery.dataTables.min.js"></script>
<script src="site_libs/dt-core-bootstrap-1.10.12/js/dataTables.bootstrap.min.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">ソフトウェアメトリクス統計分析入門</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    例題
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./example_1.html">第1章 例題解答例</a>
    </li>
    <li>
      <a href="./example_2.html">第2章 例題解答例</a>
    </li>
    <li>
      <a href="./example_3.html">第3章 例題解答例</a>
    </li>
    <li>
      <a href="./example_4.html">第4章 例題解答例</a>
    </li>
    <li>
      <a href="./example_5.html">第5章 例題解答例</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    演習
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./exercise_1.html">第1章 演習解答例</a>
    </li>
    <li>
      <a href="./exercise_2.html">第2章 演習解答例</a>
    </li>
    <li>
      <a href="./exercise_3.html">第3章 演習解答例</a>
    </li>
    <li>
      <a href="./exercise_4.html">第4章 演習解答例</a>
    </li>
    <li>
      <a href="./exercise_5.html">第5章 演習解答例</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    その他
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./about.html">R環境情報</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Model/Infer
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../index.html">
        <span class="fa fa-home"></span>
         
        Model/Infer Top
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../../stats/index.html">
        <span class="fa fa-bar-chart"></span>
         
        統計
      </a>
    </li>
    <li>
      <a href="../../books/index.html">
        <span class="fa fa-book"></span>
         
        書籍
      </a>
    </li>
    <li>
      <a href="../../gacco/index.html">
        <span class="fa fa-graduation-cap"></span>
         
        gacco
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-github"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../../">
        <span class="fa fa-github"></span>
         
        Cabinet
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../../../import/">　Import</a>
    </li>
    <li>
      <a href="../../../tidy/">　Tidy/Transform</a>
    </li>
    <li>
      <a href="../../index.html">
        <span class="fa fa-home"></span>
         
        Model/Infer
      </a>
    </li>
    <li>
      <a href="../../visualize/">　Visualize</a>
    </li>
    <li>
      <a href="../../communicate/">　Communicate/Automate</a>
    </li>
    <li>
      <a href="../../program/">　Program</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://sites.google.com/site/kantometrics/home">
        <span class="fa fa-google"></span>
         
        データ分析勉強会
      </a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">第3章 例題解答例</h1>

</div>


<!-- Include Common Links -->
<!-- SQiP -->
<!-- Books -->
<!-- Creative Commons -->
<!-- R -->
<!-- RStudio -->
<!-- Cabinet Pages -->
<div id="はじめに" class="section level1 unnumbered">
<h1>はじめに</h1>
<p>本資料は『<a href="http://www.juse-p.co.jp/cgi-bin/html.pl5?i=ISBN978-4-8171-9558-6" title="ソフトウェアメトリクス統計分析入門">ソフトウェアメトリクス統計分析入門</a>』(以降、テキストと記載)の第3章の例題を<a href="https://www.r-project.org/" title="The R Project">R</a>で解いた際の解答例を示したものです。また、<a href="http://rmarkdown.rstudio.com/" title="R Markdown form RStudio">R Markdown</a>を使うメリットを示すための一手段として作成していますので、テキストにおける計算方法とは異なる部分もあります。本資料で使用しているデータの入手に関してはテキストにてご確認下さい。<br />
本資料がHTML形式の場合、Rのコードを参照するには右側にある<strong><code>[Code]</code></strong>ボタンをクリックして下さい。なお、JavaScriptは必ずOnにしてご覧下さい。</p>
</div>
<div id="例題-3.1" class="section level1">
<h1>例題 3.1</h1>
<blockquote>
<p>表3.4にレビュー指摘による欠陥密度データが11 個あります。 データをそれぞれ適用したレビュー技法ごとに分類しています。 レビュー対象の品質を考慮して技法を使い分けすることは特にしていない前提とします。 レビュー技法の違いは、欠陥密度に対して影響を与えているといえるでしょうか。</p>
</blockquote>
<div id="データの設定" class="section level2">
<h2>データの設定</h2>
<p>本例題で利用するデータは予めCSVファイルとして保存されているものとします。表3.4で示めされているようにデータはワイドフォーマット（アンスタック形式）で「対応なし・各群の標本数が異なる」データとなっています。 Rで処理するためには基本的にロングフォーマット（スタック形式）に変換する必要がありますので、予めロングフォーマットに変換しておくか、読み込んでからロングフォーマットに変換します。</p>
<div id="フォーマット変換" class="section level3">
<h3>フォーマット変換</h3>
<p>データはすぐに分析できる形で保存されていることは稀です。これは、データ分析に慣れていない人が整理していたり、説明がしやすい形に整理されていることに起因します。しかし、これらのデータを手動で変換していると変換間違いが混入する可能性が高いので、できる限り自動化して間違いを防ぎたいものです。また、データ量が多い場合には工数削減に直結するので変換処理の自動化は覚えておいて損はありません。</p>
<p>Rにおいてフォーマット変換を行う方法はいくつかありますが、ここでは<code>tidyr</code>パッケージを用いた方法を紹介します。なお、<code>tidyr</code>パッケージは<code>dplyr</code>パッケージと共に使うことを前提に設計されています。</p>
<div id="データの準備" class="section level4">
<h4>データの準備</h4>
<p>今回用いる表3.4は、見出し行を除いたデータだけのCSV形式として保存しておきます</p>
<table>
<thead>
<tr class="header">
<th>RM</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>2.2</td>
<td>3.4</td>
<td>2.8</td>
<td>1.2</td>
</tr>
<tr class="even">
<td>I</td>
<td>3.0</td>
<td>4.4</td>
<td>5.8</td>
<td></td>
</tr>
<tr class="odd">
<td>W</td>
<td>4.6</td>
<td>4.2</td>
<td>4.0</td>
<td>4.8</td>
</tr>
</tbody>
</table>
<ul>
<li>上表は便宜上、列名（ヘッダ）を記載してありますが、今回は列名（ヘッダ）のないデータ形式としておきます</li>
<li>列名（ヘッダ）があっても基本的な処理は同じです</li>
</ul>
</div>
<div id="データの読み込みと変換" class="section level4">
<h4>データの読み込みと変換</h4>
<p>次に以下の手順でファイルを読み込み変換処理を行います。</p>
<ol style="list-style-type: decimal">
<li>1列目のレビュー技法（分類）は行名として読み込みます（列名は自動付与）</li>
<li>読み込んだデータフレームを転置します（行名が列名になります）</li>
<li>データフレーム型に変換します（転置後はマトリクス型になるため）</li>
<li>ロングフォーマットに変換します</li>
<li>分類の列を因子型に変換します（転置後は文字列型になるため）</li>
<li>使用しないNAデータを削除します</li>
</ol>
<p>実際の処理手順は下記の<code>Code</code>ボタンをクリックしてコードを展開して確認してください。なお、データ数が多い場合はデータフレーム型と互換性のあるテーブル・ データフレーム型（<code>tbl_df</code>）に変換しておくと何かと便利です。</p>
<p>ロングフォーマットに変換したデータは以下のようになります。</p>
<pre class="r"><code># HTML出力またはコンソール出力の場合はインタラクティブなテーブル表示とする
x %&gt;% 
  rename(&#39;レビュー技法&#39; = review.method, &#39;指摘密度&#39; = defect.density) %&gt;% 
  df_print(caption = &quot;分析対象データ&quot;)</code></pre>
<div id="htmlwidget-bb03741bdadedfc48136" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bb03741bdadedfc48136">{"x":{"style":"bootstrap","filter":"none","caption":"<caption>分析対象データ<\/caption>","data":[["1","2","3","4","5","6","7","9","10","11","12"],["A","A","A","A","W","W","W","I","I","I","I"],[2.2,3.4,2.8,1.2,3,4.4,5.8,4.6,4.2,4,4.8]],"container":"<table class=\"table table-striped table-hover table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>レビュー技法<\/th>\n      <th>指摘密度<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>x %&gt;% 
  group_by(review.method) %&gt;% 
  summarise(n = n()) %&gt;% 
  rename(&#39;レビュー技法&#39; = review.method, &#39;データ数&#39; = n) %&gt;% 
  df_print(caption = &quot;各群のデータ数&quot;)</code></pre>
<table>
<caption>各群のデータ数</caption>
<thead>
<tr class="header">
<th align="left">レビュー技法</th>
<th align="center">データ数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="left">I</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="left">W</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="逆フォーマット変換" class="section level3">
<h3>逆フォーマット変換</h3>
<p>ロングフォーマットをワイドフォーマットに再変換したい場合は、再変換時に行識別ができるように以下のような行識別情報を持ったデータフレームを保持しておきます。</p>
<pre class="r"><code>file &lt;- &quot;./data/ex_3.1_w.csv&quot;   # ワイドフォーマットで読み込む

x.l &lt;- read.csv(file, header = FALSE, sep = &quot;,&quot;, row.names = 1,
                fileEncoding = &quot;CP932&quot;) %&gt;%
  t() %&gt;%         # 転置行列の作成
  tbl_df() %&gt;%    # データフレーム型への変更 as.data.frame() %&gt;%
  mutate(id = row_number()) %&gt;% 
                  # 行識別情報を付加する
  tidyr::gather(key = review.method, value = defect.density, -id) %&gt;%
                  # ロングフォーマットへの変換
  mutate(review.method = as.factor(review.method)) 
                  # 因子型への変換

# HTML出力またはコンソール出力の場合はインタラクティブなテーブル表示とする
df_print(x.l, caption = &quot;ロングフォーマット（スタック形式）&quot;)</code></pre>
<div id="htmlwidget-5fd3c990a3bfd0e7d495" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5fd3c990a3bfd0e7d495">{"x":{"style":"bootstrap","filter":"none","caption":"<caption>ロングフォーマット（スタック形式）<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12"],[1,2,3,4,1,2,3,4,1,2,3,4],["A","A","A","A","W","W","W","W","I","I","I","I"],[2.2,3.4,2.8,1.2,3,4.4,5.8,null,4.6,4.2,4,4.8]],"container":"<table class=\"table table-striped table-hover table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>review.method<\/th>\n      <th>defect.density<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>x.w &lt;- x.l %&gt;% 
  tidyr::spread(key = review.method, value = defect.density) %&gt;% 
  dplyr::select(-id)

df_print(x.w, caption = &quot;ワイドフォーマット（アンスタック形式）&quot;)</code></pre>
<table>
<caption>ワイドフォーマット（アンスタック形式）</caption>
<thead>
<tr class="header">
<th align="right">A</th>
<th align="right">I</th>
<th align="right">W</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2.2</td>
<td align="right">4.6</td>
<td align="right">3.0</td>
</tr>
<tr class="even">
<td align="right">3.4</td>
<td align="right">4.2</td>
<td align="right">4.4</td>
</tr>
<tr class="odd">
<td align="right">2.8</td>
<td align="right">4.0</td>
<td align="right">5.8</td>
</tr>
<tr class="even">
<td align="right">1.2</td>
<td align="right">4.8</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>df_print(t(x.w), caption = &quot;ワイドフォーマット（非推奨形式）&quot;)</code></pre>
<table>
<caption>ワイドフォーマット（非推奨形式）</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td align="right">2.2</td>
<td align="right">3.4</td>
<td align="right">2.8</td>
<td align="right">1.2</td>
</tr>
<tr class="even">
<td>I</td>
<td align="right">4.6</td>
<td align="right">4.2</td>
<td align="right">4.0</td>
<td align="right">4.8</td>
</tr>
<tr class="odd">
<td>W</td>
<td align="right">3.0</td>
<td align="right">4.4</td>
<td align="right">5.8</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="データ分布の確認" class="section level2">
<h2>データ分布の確認</h2>
<p>技法の違いが欠陥密度に与える影響を見るには分散分析<code>aov{stats}</code>を用いるのが適当であると考えられますが、分散分析は母集団の分布を以下のように仮定しています。</p>
<ul>
<li>正規分布にしたがう</li>
<li>等分散である</li>
</ul>
<p>今回は各群（水準）のデータ数が3～4個と少ないため、正規性についてはデータ数が増えれば正規分布になるという仮定の元、検定を省略します。等分散性については等分散が認められなければWelch検定を用いることにします。</p>
<div id="等分散性の検定" class="section level3">
<h3>等分散性の検定</h3>
<p>今回は各群（水準）のデータ数が3～4個と少ないですが念のために等分散性の検定を行います。各群（水準）のデータ数は前述のように異なり、また、各値の対応はありませんので、3水準以上に対応できるバートレットの検定<code>bartlett.test{stats}</code>にて等分散性を確認します。</p>
<pre class="r"><code>bartlett.test(defect.density ~ review.method, data = x)</code></pre>
<pre><code>## 
##  Bartlett test of homogeneity of variances
## 
## data:  defect.density by review.method
## Bartlett&#39;s K-squared = 3.3812, df = 2, p-value = 0.1844</code></pre>
</div>
</div>
<div id="一元配置分散分析" class="section level2">
<h2>一元配置分散分析</h2>
<p>帰無仮説は棄却されませんでしたので、対象のデータは等分散性がないとは言えないため一元配置分散分析<code>aov{stats}</code>を用いて各群（水準）間の平均値の有意差の有無を確認します。</p>
<pre class="r"><code>result.aov &lt;- aov(defect.density ~ review.method, data = x)
summary(result.aov)</code></pre>
<pre><code>##               Df Sum Sq Mean Sq F value Pr(&gt;F)  
## review.method  2  10.18   5.091   5.852 0.0272 *
## Residuals      8   6.96   0.870                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="多重比較" class="section level2">
<h2>多重比較</h2>
<p>一元配置分散分析の結果、<span class="math inline">\(5\%\)</span>有意で帰無仮説は棄却されましたので、どの各群（水準）間に有意差があるかを多重比較により確認します。対象は前述の通り対応がなく各群（水準）のデータ数が異なりますので、多重比較としていくつかの検定方法がありますが、ここでは、Rcmdrで使われているテューキー・クレーマー法による多重比較を行います。</p>
<pre class="r"><code># Rcmdr
result.pairs &lt;- multcomp::glht(result.aov,
                               linfct = multcomp::mcp(review.method = &quot;Tukey&quot;))
summary(result.pairs)</code></pre>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Multiple Comparisons of Means: Tukey Contrasts
## 
## 
## Fit: aov(formula = defect.density ~ review.method, data = x)
## 
## Linear Hypotheses:
##            Estimate Std. Error t value Pr(&gt;|t|)  
## I - A == 0   2.0000     0.6595   3.032   0.0389 *
## W - A == 0   2.0000     0.7124   2.807   0.0540 .
## W - I == 0   0.0000     0.7124   0.000   1.0000  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## (Adjusted p values reported -- single-step method)</code></pre>
<pre class="r"><code># TukeyHSD
result.tukey &lt;- TukeyHSD(result.aov)
result.tukey</code></pre>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = defect.density ~ review.method, data = x)
## 
## $review.method
##     diff         lwr      upr     p adj
## I-A    2  0.11538605 3.884614 0.0386871
## W-A    2 -0.03561572 4.035616 0.0538138
## W-I    0 -2.03561572 2.035616 1.0000000</code></pre>
<p>多重比較の結果、I(インスペクション)とA(アドホック)において有意差が認められます。</p>
</div>
<div id="結果の可視化" class="section level2">
<h2>結果の可視化</h2>
<p>因子間の平均の差の95%信頼区間は以下の通りとなります。</p>
<pre class="r"><code># Rcmdrにおける多重比較を行った場合
x.result &lt;- as.data.frame(confint(result.pairs)$confint) %&gt;% 
  mutate(review.method = as.factor(row.names(.))) %&gt;% 
  select(factor = review.method, lo = lwr, mu = Estimate, up = upr)

# TukeyHSDを使用した場合
# x.result &lt;- as.data.frame(result.tukey$review.method) %&gt;% 
#   mutate(review.method = as.factor(row.names(.))) %&gt;% 
#   select(factor = review.method, lo = lwr, mu = diff, up = upr)

ggplot(x.result, aes(x = factor, y = mu)) +
  geom_hline(yintercept = 0, linetype = &quot;dashed&quot;, colour = &quot;red&quot;) +
  geom_errorbar(aes(ymin = lo, ymax = up), width = 0.05, colour = &quot;blue&quot;) +
  geom_point(size = 3) +
  xlab(&quot;レビュー技法&quot;) + ylab(&quot;レビュー密度の平均値の差&quot;) +
  theme(axis.text = element_text(size = 12)) +
  ggtitle(&quot;95%信頼区間&quot;) + 
  coord_flip()</code></pre>
<p><img src="example_3_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="各群の平均値の95信頼区間" class="section level2">
<h2>各群の平均値の95%信頼区間</h2>
<pre class="r"><code>n &lt;- 2
x.result &lt;- x %&gt;%
  group_by(review.method) %&gt;%
  summarize(lo = round(t.test(defect.density)$conf.int[1], n),
            mu = round(t.test(defect.density)$estimate, n),
            up = round(t.test(defect.density)$conf.int[2], n),
            num = n())

ggplot(x.result, aes(x = review.method, y = mu)) +
    geom_point(size = 3) +
    geom_errorbar(aes(ymin = lo, ymax = up), width = 0.1, colour = &quot;blue&quot;) +
    xlab(&quot;レビュー技法&quot;) + ylab(&quot;レビュー密度&quot;) +
    theme(axis.text = element_text(size = 12)) +
    ggtitle(&quot;因子毎の母平均の95%信頼区間&quot;)</code></pre>
<p><img src="example_3_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
</div>
<div id="例題-3.2" class="section level1">
<h1>例題 3.2</h1>
<blockquote>
<p>システム構成の違いがシステムのパフォーマンスにどの程度の影響を与えるのかを調べるために以下のようなデータを収集し、一元配置分散分析を行いました。 システム構成の違いがパフォーマンスに与える影響力は誤差範囲ではないといえるでしょうか。</p>
</blockquote>
<div id="データの設定-1" class="section level2">
<h2>データの設定</h2>
<p>本例題で利用するデータは予めCSVファイルとして保存されているものとします。なお、例題3.1で示したように例題3.2でもフォーマット変換により分析対象となるデータフレームを作成しています。</p>
<pre class="r"><code># 例題のデータを変形せずに読み込み、分析用データフレームに変換する
file &lt;- &quot;./data/ex_3.2.csv&quot;
x &lt;- read.csv(file, header = FALSE, row.names = 1, sep = &quot;,&quot;,
              fileEncoding = &quot;CP932&quot;) %&gt;%
  # システム構成の列を行名に設定して転置するのがポイント
  t() %&gt;%
  as.data.frame() %&gt;%
  tidyr::gather(key = sys.config, value = r.time) %&gt;% 
  mutate(sys.config = as.factor(sys.config))
  # mcp{multcomp}では因子型である必要があるため文字列型から変換

df_print(x)</code></pre>
<div id="htmlwidget-f745df66f7e6ac23e591" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f745df66f7e6ac23e591">{"x":{"style":"bootstrap","filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12"],["A","A","A","B","B","B","C","C","C","D","D","D"],[200,220,210,240,280,260,220,240,260,200,170,200]],"container":"<table class=\"table table-striped table-hover table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sys.config<\/th>\n      <th>r.time<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="データ分布の確認-1" class="section level2">
<h2>データ分布の確認</h2>
<p>例題3.1と同じで分散分析<code>aov{stats}</code>を用いるのが適当だと考えますが、念のためにデータ分布の確認を行います。正規性の検定については例題3.1と同じ理由から省略します。</p>
<div id="等分散性の確認" class="section level3">
<h3>等分散性の確認</h3>
<pre class="r"><code>bartlett.test(r.time ~ sys.config, data = x)</code></pre>
<pre><code>## 
##  Bartlett test of homogeneity of variances
## 
## data:  r.time by sys.config
## Bartlett&#39;s K-squared = 0.86607, df = 3, p-value = 0.8336</code></pre>
</div>
</div>
<div id="一元配置分散分析-1" class="section level2">
<h2>一元配置分散分析</h2>
<p>帰無仮説は棄却されませんでしたので、対象データは等分散性がないとはいえないために一元配置分散分析<code>aov{stats}</code>を用いて各群（水準）間の平均値の有意差の有無を確認します。</p>
<pre class="r"><code>result.aov &lt;- aov(r.time ~ sys.config, data = x)
summary(result.aov)</code></pre>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## sys.config   3   8700    2900   9.667 0.00489 **
## Residuals    8   2400     300                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="多重比較-1" class="section level2">
<h2>多重比較</h2>
<p>一元配置分散分析の結果、<span class="math inline">\(5\%\)</span>有意で帰無仮説は棄却されましたので、多重比較により各群（水準）間に有意差があるのかを確認します。ここでもRcmdrで使われているティキュー・クレーマー法を用います。</p>
<pre class="r"><code># Rcmdr
result.pairs &lt;- multcomp::glht(result.aov,
                               linfct = multcomp::mcp(sys.config = &quot;Tukey&quot;))
summary(result.pairs)</code></pre>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Multiple Comparisons of Means: Tukey Contrasts
## 
## 
## Fit: aov(formula = r.time ~ sys.config, data = x)
## 
## Linear Hypotheses:
##            Estimate Std. Error t value Pr(&gt;|t|)   
## B - A == 0    50.00      14.14   3.536   0.0315 * 
## C - A == 0    30.00      14.14   2.121   0.2254   
## D - A == 0   -20.00      14.14  -1.414   0.5253   
## C - B == 0   -20.00      14.14  -1.414   0.5253   
## D - B == 0   -70.00      14.14  -4.950   0.0048 **
## D - C == 0   -50.00      14.14  -3.536   0.0315 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## (Adjusted p values reported -- single-step method)</code></pre>
<pre class="r"><code># TukeyHSD
result.tukey &lt;- TukeyHSD(result.aov)
result.tukey</code></pre>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = r.time ~ sys.config, data = x)
## 
## $sys.config
##     diff         lwr        upr     p adj
## B-A   50    4.711904  95.288096 0.0313874
## C-A   30  -15.288096  75.288096 0.2252476
## D-A  -20  -65.288096  25.288096 0.5252407
## C-B  -20  -65.288096  25.288096 0.5252407
## D-B  -70 -115.288096 -24.711904 0.0049175
## D-C  -50  -95.288096  -4.711904 0.0313874</code></pre>
<p>多重比較の結果、システム構成A-B間、システム構成B-D間、システム構成C-D間に有意差が認められます。</p>
</div>
<div id="結果の可視化-1" class="section level2">
<h2>結果の可視化</h2>
<p>因子間の平均の差の95%信頼区間は以下の通りとなります。</p>
<pre class="r"><code>x.result &lt;- as.data.frame(confint(result.pairs)$confint) %&gt;% 
  mutate(sys.config = as.factor(row.names(.))) %&gt;% 
  select(factor = sys.config, lo = lwr, mu = Estimate, up = upr)

ggplot(x.result, aes(x = factor, y = mu)) +
  geom_hline(yintercept = 0, linetype = &quot;dashed&quot;, colour = &quot;red&quot;) +
  geom_errorbar(aes(ymin = lo, ymax = up), width = 0.05, colour = &quot;blue&quot;) +
  geom_point(size = 3) +
  xlab(&quot;システム構成&quot;) + ylab(&quot;レスポンスタイムの平均値の差[msec]&quot;) +
  theme(axis.text = element_text(size = 12)) +
  ggtitle(&quot;95%信頼区間&quot;) + 
  coord_flip()</code></pre>
<p><img src="example_3_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>この結果から</p>
<ul>
<li>システム構成Aはシステム構成B,Cに比べてレスポンスタイムの平均値が低い</li>
<li>システム構成Aはシステム構成Dに比べてレスポンスタイムの平均値が高い</li>
<li>システム構成Dはシステム構成A,B,Cに比べてレスポンスタイムの平均値が低い</li>
</ul>
<p>となります。単純にレスポンスタイムの平均値だけで決めるのであればシステム構成Dを選択すればよいことになります。しかし、システム構成AとDの平均値の差の95%信頼区間を確認すると必ずもシステム構成Dのレスポンスタイムが短いとは言い切れません。</p>
</div>
<div id="各群の平均値の95信頼区間-1" class="section level2">
<h2>各群の平均値の95%信頼区間</h2>
<p>そこで、各システム構成の平均値の95%信頼区間を確認してみます。</p>
<pre class="r"><code>n &lt;- 2
x.result &lt;- x %&gt;%
  group_by(sys.config) %&gt;%
  summarize(lo = round(t.test(r.time)$conf.int[1], n),
            mu = round(t.test(r.time)$estimate, n),
            up = round(t.test(r.time)$conf.int[2], n),
            num = n())

ggplot(x.result, aes(x = sys.config, y = mu)) +
    geom_point(size = 3) +
    geom_errorbar(aes(ymin = lo, ymax = up), width = 0.1, colour = &quot;blue&quot;) +
    xlab(&quot;システム構成&quot;) + ylab(&quot;レスポンスタイムの平均値[msec]&quot;) +
    theme(axis.text = element_text(size = 12)) +
    ggtitle(&quot;因子毎の母平均の95%信頼区間&quot;)</code></pre>
<p><img src="example_3_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>平均値でみるとシステム構成Dの方がレスポンスタイムが短いですが、95%信頼区間を見るとシステム構成Aの方が狭くレスポンスタイムにばらつきがありません。これより</p>
<ul>
<li>安定したレスポンスタイムが求められる場合はシステム構成A</li>
<li>全体として短いレスポンスタイムが求められる場合はシステム構成D</li>
</ul>
<p>という選択ができると考えます。</p>
</div>
</div>
<div id="付録" class="section level1">
<h1>付録</h1>
<div id="等分散性の検定-1" class="section level2">
<h2>等分散（性）の検定</h2>
<p>分散分析は母集団が正規分布で等分散であることを仮定としています。そこで、事前検定として正規性の検定や等分散（性）の検定を行います。正規性の検定については、ここでの説明は省略します。 Rcmdrで利用できるF検定（分散比の検定）<code>var.test{stats}</code>は2群（水準）に対する検定ですので、3群（水準）以上を対象にする場合は以下の検定を用います。なお、帰無仮説は全て「各群（水準）の分散はすべて等しい」です。</p>
<table>
<thead>
<tr class="header">
<th>検定方法</th>
<th>正規性</th>
<th>標本数</th>
<th>Rcmdr</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>バートレット</td>
<td>要</td>
<td>同/異</td>
<td>あり</td>
<td></td>
</tr>
<tr class="even">
<td>ルービン</td>
<td>不要</td>
<td>同/異</td>
<td>あり</td>
<td></td>
</tr>
<tr class="odd">
<td>ハートレイ</td>
<td>？</td>
<td>同</td>
<td>なし</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div id="分散分析" class="section level2">
<h2>分散分析</h2>
<p>分散分析の帰無仮説は「各群（水準）の平均値は等しい」ですが、注意する点として対立仮説が「各群の組み合わせの少なくとも一組に平均値の差がある」となることです。分散分析だけでは、どの群間に有意差があるかまではわかりません。なお、検定対象データが等分散でない場合はウェルチ検定を用います。</p>
<table>
<thead>
<tr class="header">
<th>検定方法</th>
<th>正規性</th>
<th>等分散</th>
<th>Rcmdr</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>分散分析(aov)</td>
<td>要</td>
<td>要</td>
<td>あり</td>
<td><code>aov{stats}</code>, <code>oneway.test{stats}</code><sup>1</sup></td>
</tr>
<tr class="even">
<td>ウェルチ</td>
<td>要</td>
<td>不要</td>
<td>あり<sup>2</sup></td>
<td><code>oneway.test{stats}</code><sup>1</sup></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> オプション指定により等分散、不等分散のどちらもにも対応します<br />
<sup>2</sup> Rcmdr 2.3-0以降であれば実行可能です</p>
</div>
<div id="多重比較-2" class="section level2">
<h2>多重比較</h2>
<p>一元配置分散分析は前述のように因子の差（各群（水準）の平均値の差）の有無について検定するだけですので、各群（水準）間のどこに有意差があるかを見るためには事後検定（下位検定）として多重比較が必要です。事後検定はデータにより検定方法が分かれますので注意が必要です。</p>
<table>
<thead>
<tr class="header">
<th>検定方法</th>
<th>標本数</th>
<th>対応<sup>3</sup></th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>テューキー</td>
<td>同</td>
<td>なし</td>
<td><code>TukeyHSD{stats}</code></td>
</tr>
<tr class="even">
<td>テューキー・クレーマー</td>
<td>異</td>
<td>なし</td>
<td><code>TukeyHSD{stats}</code></td>
</tr>
<tr class="odd">
<td>ボンフェローニ</td>
<td>同</td>
<td>あり/なし</td>
<td>5水準以下が目安, <code>pairwise.t.test{stats}</code><sup>4</sup></td>
</tr>
<tr class="even">
<td>ホルム</td>
<td>同</td>
<td>あり/なし</td>
<td><code>pairwise.t.test{stats}</code><sup>4</sup></td>
</tr>
<tr class="odd">
<td>一般線形モデル</td>
<td>同/異</td>
<td>なし</td>
<td>Rcmdr, <code>gmlh{multcomp}</code><sup>5</sup></td>
</tr>
</tbody>
</table>
<p><sup>4</sup> オプション指定によりボンフェローニ、ホルムのどちらも対応します<br />
<sup>3</sup> 「対応」とは各群のデータが同一人物による回答や測定であるような場合で、具体例は参考文献で確認してください<br />
<sup>5</sup> オプションでテューキー法が指定されていて、結果を見る限り<code>TukeyHSD{stats}</code>と同等のようです</p>
</div>
<div id="参考文献" class="section level2">
<h2>参考文献</h2>
<ul>
<li><a href="http://133.100.216.71/R_analysis/test_anova01.html">一元配置分散分析 概要</a></li>
<li><a href="http://133.100.216.71/R_analysis/test_anova_iris02.html">一元配置の分散分析と多重比較 不等分散</a></li>
<li><a href="http://133.100.216.71/R_analysis/test_t06_anova.html">一元配置分散分析 対応あり</a></li>
<li><a href="http://homepage2.nifty.com/nandemoarchive/toukei_hosoku/anova_jizen_kentei.htm">分散分析の事前検定</a></li>
<li><a href="http://www.ibaraki-kodomo.com/toukei/posthoc.html">多重比較</a></li>
</ul>
<hr />
<!-- Include Footer -->
<p><img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" title="CC BY-NC-SA 4.0 icon" alt="Sampo Suzuki" /> <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja" title="CC BY-NC-SA 4.0">CC BY-NC-SA 4.0</a>, Sampo Suzuki [2017-04-22 14:22(JST)]</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
