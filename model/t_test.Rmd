---
# title: "基礎知識"
output: 
  html_document:  
    number_section: no
---

<!-- Include shared Links -->
```{r t_test, child="../shared/links.Rmd"}
```

```{r setup, include=FALSE}
# 共通chunkオプションの指定
knitr::opts_chunk$set(warning = FALSE, echo = TRUE)

# データハンドリングで利用するパッケージの読み込み
require(tidyverse)

# コンフリクトの解消
tidyverse::tidyverse_conflicts()
```

　  

# 平均値の差の検定
平均値の差の検定（母平均の差の検定）は**一つの因子**による効果に差があるか否かを検証する場合に使う手法です。比較する標本数（水準数、群数）により検定方法が異なります。  

　  

標本数     | 検定方法 
-----------|---------
２標本以下 | t検定
３標本以上 | 一元配置分散分析

　  

t検定については本ページで組み込みデータセット**`sleep`**を用いた説明を行います。一元配置分散分析については準備中です。  
　  

## **`sleep`**データセット
**`sleep`**データセットは10人の患者に対して二種類の睡眠薬を投与した際の睡眠時間の増減データです。ですから本来は対応のあるデータとして扱う必要がありますが、ここでは便宜上、対応のないデータとしても扱っている点に注意してください。  
```{r}
sleep
```

　  
すなわち対応の「あり」、「なし」に応じて項目を以下のように読み替えています。あくまでも説明を行う上での便宜上の扱いですので、実際の分析では決してこのような扱いをしないでください。  
　  

　    | 「対応の`ある`」として扱う場合 | 「対応の`ない`」として扱う場合
------|--------------------------------|----------------------------
extra | 睡眠時間の増減 [H]             | 睡眠時間の増減 [H]
group | 睡眠薬の種類（2種類）          | 被験者グループ識別番号（2グループ）
ID    | 被験者の識別番号               | グループ内での被験者の識別番号

　  

## 必要なパッケージ
本ページのコードを実行するには以下の追加パッケージを読み込んでおく必要があります。  

Package   | Description
----------|-------------
tidyverse | Easily Install and Load the‘Tidyverse’

　  

# t検定
t検定は前提条件により検定手法が異なりますので条件に応じて適切な検定方法を選択してください。  
　  

標本数 | 対応 | 等分散性 | 検定方法
-------|------|----------|----------------------
１     | N/A  | N/A      | １標本のt検定
２     | なし | あり     | スチューデントのt検定 ^1^ 
２     | なし | なし     | ウェルチのt検定 ^1^
２     | あり | N/A      | 対応のあるt検定

^1^ スチューデントのt検定とウェルチのt検定をまとめて独立標本t検定と呼ぶこともあります。  
　  

### 帰無仮説
各検定における帰無仮説（$H_0$）は下記の通りです。  
　  

検定方法              | 帰無仮説（$H_0$）
----------------------|-------------------------------------------
１標本のt検定         | 標本の母平均は平均値$\mu_0$に等しい
スチューデントのt検定 | 標本間の母平均に差はない（母平均は等しい）
ウェルチのt検定       | 同上
対応のあるt検定       | 同上

　  

# １標本のt検定
１標本のt検定はひとつの標本データの平均値（$\mu$）が基準値（$\mu_0$）と異なるかどうかを調べるための検定です。**`sleep`**データのグループ1の平均値が0（zero）と等しいかどうか検定してみます。
```{r}
(t.test_result <- sleep %>% 
  dplyr::filter(group == 1) %>% 
  dplyr::select(extra) %>% 
  t.test(mu = 0)) %>% 
  broom::tidy()
```

　  
有意水準（$\alpha$）を5％とした両側検定の結果、p値は`r t.test_result$p.value`で帰無仮説（$H_0$）は棄却されず平均値が0でないとは言えません。当該グループの睡眠時間の増減の平均値は`r t.test_result$estimate`[H]となり、その95％信頼区間は[`r t.test_result$conf.int[1]`, `r t.test_result$conf.int[2]`]です。  
　  
参考までにグループ2では異なった検定結果となります。  
```{r}
(t.test_result <- sleep %>% 
  dplyr::filter(group == 2) %>% 
  dplyr::select(extra) %>% 
  t.test(mu = 0) %>% 
  broom::tidy())
```

　  

# 独立標本t検定
## スチューデントのt検定
スチューデントのt検定は標本間で等分散性があることを前提条件としています。等分散性の検定については別資料で扱いますので、ここでは等分散性があると仮定してスチューデントのt検定を行います。  
```{r}
(t.test_result <- sleep %>% 
  t.test(extra ~ group, data = ., var.equal = TRUE, paired = FALSE)) %>% 
  broom::tidy()
```

　  
有意水準（$\alpha$）を5％とした両側検定の結果、p値は`r t.test_result$p.value`で帰無仮説（$H_0$）は棄却されず、平均値に差があるとは言えません。平均値の差の95％信頼区間は[`r t.test_result$conf.int[1]`, `r t.test_result$conf.int[2]`]です。  
　  

## ウェルチのt検定
ウェルチのt検定は標本間で等分散性がないことを前提条件としています。ここでは等分散性がないと仮定してウェルチのt検定を行います。  
```{r}
(t.test_result <- sleep %>% 
  t.test(extra ~ group, data = ., var.equal = FALSE, paired = FALSE)) %>% 
  broom::tidy()
```

　  
有意水準（$\alpha$）を5％とした両側検定の結果、p値は`r t.test_result$p.value`で帰無仮説（$H_0$）は棄却されず、平均値に差があるとは言えません。平均値の差の95％信頼区間は[`r t.test_result$conf.int[1]`, `r t.test_result$conf.int[2]`]です。  
　  

# 対応のあるt検定
対応のあるt検定は「関連のあるt検定」や「従属なt検定」と呼ばれる事もある対応関係のある２群間の平均値の差の検定を行うものです。**`sleep`**データセットは「対応のある」データですので、本来であればこの検定方法を用いる必要があります。  
```{r}
(t.test_result <- sleep %>% 
  t.test(extra ~ group, data = ., paired = TRUE)) %>% 
  broom::tidy()
```

　  
有意水準（$\alpha$）を5％とした両側検定の結果、p値は`r t.test_result$p.value`で帰無仮説（$H_0$）は棄却され対立仮説（$H_1$）が採択されましたので、平均値に差がないとは言えません。平均値の差の95％信頼区間は[`r t.test_result$conf.int[1]`, `r t.test_result$conf.int[2]`]です。  
　  

# Rでのt検定
[R][R]における前述のt検定は全て**`t.test`**関数で計算できます。実施したい検定により引数の指定方法が変わり、前述のように検定結果も異なってきますので検定の際には注意してください。  
　  

検定方法              | 引数の指定方法
----------------------|-------------------------------------------
１標本のt検定         | **`t.test(value, mu = mu0)`**
スチューデントのt検定 | **`t.test(value ~ group, data = df, var.equal = TRUE)`**
ウェルチのt検定       | **`t.test(value ~ group, data = df, var.equal = FALSE)`**
対応のあるt検定       | **`t.test(value ~ group, data = df, paired = TRUE)`**

　  

## 仮説の指定方法
**`t.test`**関数では三通りの仮説が指定できますが、帰無仮説（$H_0$）ではなく対立仮説（$H_1$）で指定する点に注意してください。  
　  

### １標本のt検定
１標本のt検定における対立仮説は平均$\mu$と基準値(比較値)$\mu_0$に対して下表のようになります。  

対立仮説 $($帰無仮説$)$            | 指定方法                        | 備考
-----------------------------------|---------------------------------|---
$\mu \neq \mu_0$ $(\mu = \mu_0)$   | **`alternative = "two.sided"`** | default
$\mu \lt \mu_0$ $(\mu \geq \mu_0)$ | **`alternative = "less"`**      |
$\mu \gt \mu_0$ $(\mu \leq \mu_0)$ | **`alternative = "greater"`**   |

　  

### 独立標本t検定
独立標本t検定（対応のないt検定）における対立仮説は、平均値$\mu_x$,  $\mu_y$に対して考える場合は下表のようになります。  
対立仮説を平均の差（$\delta = \mu_x - \mu_y$）で考える場合は対応のあるt検定の項を参照してください。  

対立仮説 （帰無仮説）                    | 指定方法                        | 備考
-----------------------------------------|---------------------------------|---
$\mu_x \neq \mu_y$ （$\mu_x = \mu_y$）   | **`alternative = "two.sided"`** | default 
$\mu_x \lt \mu_y$ （$\mu_x \geq \mu_y$） | **`alternative = "less"`**      | 
$\mu_x \gt \mu_y$ （$\mu_x \leq \mu_y$） | **`alternative = "greater"`**   | 

　  

### 対応のあるt検定
対応のあるt検定における対立仮説は２標本の平均の差$(\delta = \mu_x - \mu_y)$に対して下表のようになります。  

対立仮説 （帰無仮説）              | 指定方法                        | 備考
-----------------------------------|---------------------------------|---
$\delta \neq 0$ （$\delta = 0$）   | **`alternative = "two.sided"`** | default
$\delta \lt 0$ （$\delta \geq 0$） | **`alternative = "less"`**      | 
$\delta \gt 0$ （$\delta \leq 0$） | **`alternative = "greater"`**   | 

　  

# R Commanderでのt検定
R Commanderでのt検定は少しややこしい感じがあります。R Commanderではtidy data形式ではなく人間が分かりやすいmessy data形式でデータを指定する必要があるためです。これはどちらが良い悪いという話ではなくR Commanderの設計思想がそのようになっているためです。  
　  

R Commander       | 指定するデータ  | 関数の呼び出し形式
----------------- | --------------- | --------------------------------
1標本t検定        | 1標本と基準値   | t.test(x, mu = mu0)
独立サンプルt検定 | 対応のない2標本 | t.test(x, y)
対応のあるt検定   | 対応のある2標本 | t.test(x, y, paired = TRUE)   

　  

したがって、R Commanderでt検定を行う場合は上表のような形式で関数が呼び出されますので、以下のようなデータ形式（データフレーム型）でデータを用意してください。  
　  

```{r}
sleep %>% 
  tidyr::spread(key = group, value = extra) %>% 
  dplyr::rename(Group1 = `1`, Group2 = `2`) %>% 
  dplyr::select(-ID)
```

　  

---

<!-- Include Footer -->
```{r child="../shared/footer.Rmd"}
```
